(function(t,e){if(typeof define==="function"&&define.amd){define(["backbone","underscore"],e)}else if(typeof exports==="object"){module.exports=e(require("backbone"),require("underscore"))}else{t.Assembler=e(t.Backbone,t._)}})(this,function(t,e){var i={};i.View=t.View.extend({template:null,modelEvents:null,collectionEvents:null,lazy:null,constructor:function(e){this.options=e||(e={});t.View.prototype.constructor.call(this,e)},initialize:function(t){e.extend(this,e.pick(t,"template","modelEvents","collectionEvents","lazy"));if(this.template){this.setTemplate(this.template)}if(this.model){this.delegateModelEvents()}if(this.collection){this.delegateCollectionEvents()}},_listenToEvents:function(t,i){e.each(i,function(i,n){if(!e.isFunction(i)){i=this[i]}if(!i){throw new Error('Method "'+i+'" does not exist')}this.listenTo(t,n,i)},this)},delegateModelEvents:function(){this.listenTo(this.model,"change",this.voidRendered);this._listenToEvents(this.model,e.result(this,"modelEvents"))},undelegateModelEvents:function(){this.stopListening(this.model)},delegateCollectionEvents:function(){this._listenToEvents(this.collection,e.result(this,"collectionEvents"))},undelegateCollectionEvents:function(){this.stopListening(this.collection)},setModel:function(t){if(this.model){this.undelegateModelEvents()}this.model=t;if(t){this.delegateModelEvents()}this.voidRendered();return this},setCollection:function(t){if(this.collection){this.undelegateCollectionEvents()}this.collection=t;if(t){this.delegateCollectionEvents()}this.voidRendered();return this},setTemplate:function(t){if(!e.isFunction(t)){t=e.template(t)}this.template=t;this.voidRendered();return this},ready:function(e){var i=[];if(this.model){i.push(this.model.fetch(e))}if(this.collection){i.push(this.collection.fetch(e))}return this.promiseCoupler(t.$.when.apply(t.$.when,i),e)},promiseCoupler:function(t,e){return t},swapModel:function(t,e){var i=this;return t.fetch(e).done(function(){i.setModel(t);i.render()})},swapCollection:function(t,e){var i=this;return t.fetch(e).done(function(){i.setCollection(t);i.render()})},toJSON:function(){var t=this.model?this.model.toJSON():{};return this.dataDecorator(t)},dataDecorator:function(t){return t},toHTML:function(){return this.template?this.template(this.toJSON()):""},render:function(t){return this.renderElement(t).renderState(t)},renderElement:function(t){t||(t={});if(t.force||!e.result(this,"lazy")||!this._rendered){this.$el.empty().append(this.toHTML());this._rendered=true}return this},renderState:function(t){return this},attach:function(t){return this.attachElement(t).attachState()},attachElement:function(t){t||(t=this.$el);this._rendered=!!t.length;return this.setElement(t)},attachState:function(){return this},voidRendered:function(){this._rendered=false},remove:function(){if(this.parentView){this.parentView.removeView(this)}return t.View.prototype.remove.call(this)},innerHTML:function(){return this.$el.html()},outerHTML:function(){var t=e.keys(e.result(this,"attributes"));if(this.id){t.push("id")}if(this.className){t.push("class")}var i=e.result(this,"tagName");var n=e.reduce(t,function(t,e){var i;if(i=this.$el.attr(e)){return t+" "+e+'="'+i+'"'}return t},i,this);return"<"+n+">"+this.$el.html()+"</"+i+">"},clone:function(){return new this.constructor(this.options)}});i.LayoutView=i.View.extend({viewEvents:null,constructor:function(t){this.options=t||(t={});this.views=[];this._byDestination={};i.View.prototype.constructor.call(this,t)},initialize:function(t){i.View.prototype.initialize.call(this,t);e.extend(this,e.pick(t,"viewEvents"));if(t.views){this.resetViews(t.views)}},delegateViewEvents:function(t){this._listenToEvents(t,e.result(this,"viewEvents"))},undelegateViewEvents:function(t){this.stopListening(t)},getView:function(t,e){e||(e=0);var i=t.match(n),s=i[1],o=i[2];if(typeof this._byDestination[o]==="object"&&typeof this._byDestination[o][s]==="object"){return this._byDestination[o][s][e]}},addView:function(t,e,i){if(typeof e==="object"){i=e;e=null}var s=t.match(n),o=s[1],r=s[2];this._prepareForAdd(i);this._byDestination[r]||(this._byDestination[r]={});this._byDestination[r][o]||(this._byDestination[r][o]=[]);if(typeof e==="number"){this._byDestination[r][o].splice(e,0,i)}else{this._byDestination[r][o].push(i)}this.views.push(i);return i},removeView:function(t,i){var n=typeof t==="string"?this.getView(t,i):t;if(n){var s;e.each(this._byDestination,function(t,i){e.each(t,function(t,o){e.each(t,function(t,r){if(t===n){this._prepareForRemove(n);this._byDestination[i][o].splice(r,1);this.views=e.without(this.views,n);return s=false}},this);return s},this);return s},this)}},resetViews:function(t){e.each(this.views,this.removeView,this);e.each(t,function(t,e){this.addView(e,t)},this)},findViews:function(t){var e=t.match(n),i=e[1],s=e[2];if(typeof this._byDestination[s]==="object"&&typeof this._byDestination[s][i]==="object"){return this._byDestination[s][i].slice(0)}return[]},indexOf:function(t){var i=-1;e.each(this._byDestination,function(n,s){e.each(n,function(n,s){return(i=e.indexOf(n,t))!==-1});return i!==-1});return i},_prepareForAdd:function(t){t.parentView=this;this.delegateViewEvents(t)},_prepareForRemove:function(t){if(t.parentView===this){delete t.parentView}this.undelegateViewEvents(t);t.remove()},ready:function(t){var n=i.View.prototype.ready.call(this,t);var s=[];e.each(this.views,function(t){s.push(t.ready())},this);return n.then(function(){return $.when.apply($.when,s)})},swapView:function(t,e,i,n){if(typeof e==="object"){n=i;i=e;e=null}var s=this;return i.ready(n).done(function(){s.removeView(t,e);s.addView(t,i);s.renderViews()})},_partial:function(t,e,i,n,o){$el=e?this.$el.find(e):this.$el;return s[t].call(this,$el,i,n,o)},render:function(t){return this.renderElement(t).renderViews(t).renderState(t)},renderViews:function(t){e.each(this._byDestination,function(i,n){e.each(i,function(i,s){var o=i.length;e.each(i,function(e,i){this._partial(s,n,i,o,e.render(t).$el);e.delegateEvents()},this)},this)},this);return this},attach:function(t){return this.attachElement(t).attachViews().attachState()},attachViews:function(){e.each(this._byDestination,function(t,i){e.each(t,function(t,n){var s=t.length;e.each(t,function(t,e){var o=this._partial(n,i,e,s);if(o[0]){t.attach(o)}},this)},this)},this);return this}});var n=/^(inner|outer|prepend|append|before|after)\s*(.*)\s*$/i;var s={inner:function(t,e,i,n){if(n){return t.empty().append(n)}return t.children().first()},outer:function(t,e,i,n){if(n&&n[0]!==t[0]){return t.replaceWith(n)}return t},prepend:function(t,e,i,n){if(n){return t.prepend(n)}return t.children().eq(i-1-e)},append:function(t,e,i,n){if(n){return t.append(n)}return t.children().eq(e-i)},before:function(t,e,i,n){if(n){return t.before(n)}return t.prevAll().eq(i-1-e)},after:function(t,e,i,n){if(n){return t.after(n)}return t.nextAll().eq(i-1-e)}};i.ListView=i.LayoutView.extend({itemDestination:"append",itemView:i.View,initialize:function(t){e.extend(this,e.pick(t,"itemDestination","itemView"));if(!this.itemView){throw new Error("ListView.initialize expects this.itemView or options.itemView")}else if(!e.isFunction(this.itemView)){throw new Error("ListView.initialize expects this.itemView to be a constructor")}i.LayoutView.prototype.initialize.call(this,t);if(this.collection){this.resetItemViews(this.collection)}},delegateCollectionEvents:function(){this.listenTo(this.collection,"add",this.addItemView);this.listenTo(this.collection,"remove",this.removeItemView);this.listenTo(this.collection,"reset",this.resetItemViews);this.listenTo(this.collection,"sort",this.sortItemViews);i.LayoutView.prototype.delegateCollectionEvents.call(this)},setCollection:function(t){this.resetItemViews(t);return i.LayoutView.prototype.setCollection.call(this,t)},createItemView:function(t){return new this.itemView({app:this.app,model:t})},addItemView:function(t,e,i){return this.addView(this.itemDestination,typeof i==="object"?i.at:undefined,this.createItemView(t))},removeItemView:function(t){return this.removeView(this.getItemView(t))},getItemView:function(i){if(i instanceof t.Model){return e.find(this.views,function(t){return t.model===i})}return this.getView(this.itemDestination,i)},resetItemViews:function(t){e.each(this.findViews(this.itemDestination),this.removeView,this);t.each(this.addItemView,this)},sortItemViews:function(t){this.resetItemViews(t)}});return i});
//# sourceMappingURL=dist/assembler-min.map